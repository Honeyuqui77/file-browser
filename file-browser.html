<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“š é†’é†’ä¸“å±ä¹¦ç±æ–‡ä»¶ç®¡ç†å™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .toolbar {
            background: #f8f9fa;
            padding: 20px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .select-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        .select-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }
        
        .back-btn {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            display: none;
            box-shadow: 0 4px 15px rgba(108, 117, 125, 0.3);
        }
        
        .back-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(108, 117, 125, 0.4);
        }
        
        .search-box {
            flex: 1;
            min-width: 200px;
            position: relative;
        }
        
        .search-input {
            width: 100%;
            padding: 12px 40px 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 25px;
            font-size: 14px;
            outline: none;
            transition: all 0.3s ease;
            background: white;
        }
        
        .search-input:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .search-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #667eea;
            pointer-events: none;
        }
        
        .current-path {
            flex: 1;
            padding: 10px 15px;
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-family: monospace;
            color: #495057;
            min-width: 200px;
        }
        
        .content {
            display: flex;
            height: 600px;
        }
        
        .sidebar {
            width: 300px;
            background: #f8f9fa;
            border-right: 1px solid #e9ecef;
            overflow-y: auto;
            padding: 20px;
        }
        
        .main-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }
        
        .folder-node {
            margin: 5px 0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .folder-node:hover {
            transform: translateX(5px);
        }
        
        .tag-0 {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 15px;
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 10px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        .tag-1 {
            background: linear-gradient(135deg, #4ECDC4 0%, #44A08D 100%);
            color: white;
            padding: 10px 15px;
            margin-left: 20px;
            margin-bottom: 8px;
            font-size: 14px;
            box-shadow: 0 3px 10px rgba(78, 205, 196, 0.3);
        }
        
        .tag-2 {
            background: linear-gradient(135deg, #FF6B6B 0%, #EE5A24 100%);
            color: white;
            padding: 8px 15px;
            margin-left: 40px;
            margin-bottom: 6px;
            font-size: 13px;
            box-shadow: 0 3px 10px rgba(255, 107, 107, 0.3);
        }
        
        .tag-3 {
            background: linear-gradient(135deg, #96CEB4 0%, #FFEAA7 100%);
            color: #2d3436;
            padding: 6px 15px;
            margin-left: 60px;
            margin-bottom: 4px;
            font-size: 12px;
            box-shadow: 0 2px 8px rgba(150, 206, 180, 0.3);
        }
        
        .file-item {
            background: white;
            border: 2px solid #e9ecef;
            padding: 12px 15px;
            margin: 6px 0;
            border-radius: 8px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .file-item:hover {
            background: #f8f9fa;
            transform: translateX(5px);
            border-color: #667eea;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.1);
        }
        
        .file-icon {
            margin-right: 8px;
            color: #667eea;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 35px rgba(102, 126, 234, 0.4);
        }
        
        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }
        
        .error {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
        }
        
        .success {
            background: linear-gradient(135deg, #00b894 0%, #00a085 100%);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(0, 184, 148, 0.3);
        }
        
        .breadcrumb {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 12px 18px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-family: monospace;
            border: 1px solid #dee2e6;
        }
        
        .breadcrumb span {
            color: #667eea;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .breadcrumb span:hover {
            color: #764ba2;
            text-decoration: underline;
        }
        
        .breadcrumb .separator {
            color: #6c757d;
            margin: 0 8px;
        }
        
        .file-item {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: space-between;
            user-select: none;
        }
        
        .file-item.selected {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border-color: #2196f3;
            box-shadow: 0 4px 15px rgba(33, 150, 243, 0.2);
        }
        
        .file-item.selecting {
            background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
            border-color: #ff9800;
            box-shadow: 0 4px 15px rgba(255, 152, 0, 0.2);
        }
        
        .file-checkbox {
            margin-right: 10px;
            transform: scale(1.2);
            cursor: pointer;
            accent-color: #667eea;
        }
        
        .file-info {
            flex: 1;
            display: flex;
            align-items: center;
            cursor: pointer;
        }
        
        .file-info:hover {
            color: #667eea;
        }
        
        .batch-actions {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 18px;
            border-radius: 12px;
            margin: 20px 0;
            display: none;
            border: 1px solid #dee2e6;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }
        
        .batch-actions.show {
            display: block;
        }
        
        .batch-btn {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
            padding: 10px 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin-right: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 3px 10px rgba(220, 53, 69, 0.3);
        }
        
        .batch-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(220, 53, 69, 0.4);
        }
        
        .batch-btn.success {
            background: linear-gradient(135deg, #28a745 0%, #218838 100%);
            box-shadow: 0 3px 10px rgba(40, 167, 69, 0.3);
        }
        
        .batch-btn.success:hover {
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
        }
        
        .selected-count {
            color: #667eea;
            font-weight: bold;
            margin-right: 15px;
            font-size: 16px;
        }
        
        /* å¸®åŠ©æŒ‰é’®æ ·å¼ */
        .help-btn {
            position: fixed;
            top: 30px;
            left: 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 20px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
            transition: all 0.3s ease;
            z-index: 1000;
        }
        
        .help-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(102, 126, 234, 0.6);
        }
        
        /* æŠ€æœ¯æ”¯æŒè”ç³»æ–¹å¼ */
        .support-info {
            position: fixed;
            top: 90px;
            left: 30px;
            color: #667eea;
            font-size: 14px;
            font-weight: 500;
            text-align: center;
            background: rgba(255, 255, 255, 0.9);
            padding: 8px 15px;
            border-radius: 20px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.2);
            z-index: 1000;
        }
        
        /* å¸®åŠ©å¯¹è¯æ¡†æ ·å¼ */
        .help-dialog {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        
        .help-dialog.show {
            display: flex;
        }
        
        .help-content {
            background: white;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .help-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .help-header h2 {
            margin: 0;
            font-size: 1.8em;
        }
        
        .close-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s ease;
        }
        
        .close-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.1);
        }
        
        .help-body {
            padding: 30px;
            max-height: 60vh;
            overflow-y: auto;
        }
        
        .help-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
            border-left: 4px solid #667eea;
        }
        
        .help-section h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.3em;
        }
        
        .help-section h4 {
            color: #495057;
            margin: 15px 0 10px 0;
            font-size: 1.1em;
        }
        
        .help-section p {
            color: #6c757d;
            line-height: 1.6;
            margin-bottom: 15px;
        }
        
        .help-section ul, .help-section ol {
            color: #495057;
            line-height: 1.8;
            padding-left: 20px;
        }
        
        .help-section li {
            margin-bottom: 8px;
        }
        
        .help-section strong {
            color: #667eea;
        }
        
        .move-dialog {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .move-dialog.show {
            display: flex;
        }
        
        .move-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }
        
        .move-content h3 {
            margin-bottom: 20px;
            color: #333;
        }
        
        .folder-selector {
            margin: 20px 0;
        }
        
        .folder-selector button {
            background: #667eea;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-right: 10px;
        }
        
        .folder-selector button:hover {
            background: #5a6fd8;
        }
        
        .selected-folder {
            background: #e9ecef;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-family: monospace;
        }
        
        .dialog-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }
        
        .dialog-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .dialog-btn.cancel {
            background: #6c757d;
            color: white;
        }
        
        .dialog-btn.confirm {
            background: #28a745;
            color: white;
        }
        
        .dialog-btn:hover {
            transform: translateY(-2px);
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“š é†’é†’ä¸“å±ä¹¦ç±æ–‡ä»¶ç®¡ç†å™¨</h1>
            <p>é€‰æ‹©ä½ çš„ä¹¦ç±æ–‡ä»¶å¤¹ï¼Œè‡ªåŠ¨æ„å»ºå±‚çº§ç»“æ„</p>
        </div>
        
        <div class="toolbar">
            <button class="select-btn" onclick="selectFolder()">ğŸ“ é€‰æ‹©æ–‡ä»¶å¤¹</button>
            <div class="search-box">
                <input type="text" class="search-input" placeholder="æœç´¢æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹...">
                <span class="search-icon">ğŸ”</span>
            </div>
            <div class="current-path" id="currentPath">æœªé€‰æ‹©æ–‡ä»¶å¤¹</div>
            <button class="back-btn" onclick="goBack()">â¬…ï¸ è¿”å›</button>
        </div>
        
        <div class="content">
            <div class="sidebar">
                <div id="folderTree">
                    <div class="loading">è¯·å…ˆé€‰æ‹©æ–‡ä»¶å¤¹</div>
                </div>
            </div>
            
            <div class="main-content">
                <div id="stats" class="stats" style="display: none;">
                    <div class="stat-card">
                        <div class="stat-number" id="folderCount">0</div>
                        <div class="stat-label">æ–‡ä»¶å¤¹æ•°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="fileCount">0</div>
                        <div class="stat-label">æ–‡ä»¶æ•°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="levelCount">0</div>
                        <div class="stat-label">å±‚çº§æ·±åº¦</div>
                    </div>
                </div>
                
                <div id="breadcrumb" class="breadcrumb" style="display: none;"></div>
                
                <div id="currentFolder">
                    <div class="loading">è¯·é€‰æ‹©æ–‡ä»¶å¤¹å¼€å§‹æµè§ˆ</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- æ‰¹é‡æ“ä½œæ  -->
    <div id="batchActions" class="batch-actions">
        <span class="selected-count" id="selectedCount">å·²é€‰æ‹© 0 ä¸ªæ–‡ä»¶</span>
        <button class="batch-btn" onclick="selectAllFiles()">å…¨é€‰</button>
        <button class="batch-btn" onclick="deselectAllFiles()">å–æ¶ˆå…¨é€‰</button>
        <button class="batch-btn success" onclick="showMoveDialog()">ğŸ“ æ‰¹é‡è½¬ç§»</button>
    </div>
    
    <!-- è½¬ç§»å¯¹è¯æ¡† -->
    <div id="moveDialog" class="move-dialog">
        <div class="move-content">
            <h3>ğŸ“ æ‰¹é‡è½¬ç§»æ–‡ä»¶</h3>
            <p>é€‰æ‹©ç›®æ ‡æ–‡ä»¶å¤¹ï¼Œå°†é€‰ä¸­çš„æ–‡ä»¶è½¬ç§»è¿‡å»</p>
            
            <div class="folder-selector">
                <button onclick="selectTargetFolder()">é€‰æ‹©ç›®æ ‡æ–‡ä»¶å¤¹</button>
                <div id="targetFolderPath" class="selected-folder" style="display: none;">
                    æœªé€‰æ‹©ç›®æ ‡æ–‡ä»¶å¤¹
                </div>
            </div>
            
            <div class="progress-bar" id="progressBar" style="display: none;">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            
            <div id="moveStatus"></div>
            
            <div class="dialog-buttons">
                <button class="dialog-btn cancel" onclick="closeMoveDialog()">å–æ¶ˆ</button>
                <button class="dialog-btn confirm" onclick="executeMove()" id="confirmMoveBtn">ç¡®è®¤è½¬ç§»</button>
            </div>
        </div>
    </div>

    <!-- å¸®åŠ©æŒ‰é’® -->
    <div class="help-btn" onclick="toggleHelp()">â“ å¸®åŠ©</div>
    
    <!-- æŠ€æœ¯æ”¯æŒè”ç³»æ–¹å¼ -->
    <div class="support-info">
        æŠ€æœ¯æ”¯æŒè¯·è”ç³»ï¼š<br>
        <strong>shenyicheng3</strong>
    </div>
    
    <!-- å¸®åŠ©æ–‡æ¡£ -->
    <div id="helpDialog" class="help-dialog">
        <div class="help-content">
            <div class="help-header">
                <h2>ğŸ“š é†’é†’ä¸“å±ä¹¦ç±æ–‡ä»¶ç®¡ç†å™¨ - ä½¿ç”¨è¯´æ˜</h2>
                <button class="close-btn" onclick="toggleHelp()">âœ•</button>
            </div>
            
            <div class="help-body">
                <div class="help-section">
                    <h3>ğŸš€ å¿«é€Ÿå¼€å§‹</h3>
                    <ol>
                        <li><strong>é€‰æ‹©æ–‡ä»¶å¤¹</strong>ï¼šç‚¹å‡»å·¦ä¸Šè§’çš„"ğŸ“ é€‰æ‹©æ–‡ä»¶å¤¹"æŒ‰é’®</li>
                        <li><strong>ç­‰å¾…æ‰«æ</strong>ï¼šç³»ç»Ÿä¼šè‡ªåŠ¨æ‰«æå¹¶æ„å»ºæ–‡ä»¶å¤¹å±‚çº§ç»“æ„</li>
                        <li><strong>å¼€å§‹æµè§ˆ</strong>ï¼šåœ¨å·¦ä¾§å¯ä»¥çœ‹åˆ°æ–‡ä»¶å¤¹æ ‘ï¼Œå³ä¾§æ˜¾ç¤ºå½“å‰æ–‡ä»¶å¤¹å†…å®¹</li>
                    </ol>
                </div>
                
                <div class="help-section">
                    <h3>ğŸ” æœç´¢åŠŸèƒ½</h3>
                    <ul>
                        <li><strong>å®æ—¶æœç´¢</strong>ï¼šåœ¨æœç´¢æ¡†ä¸­è¾“å…¥å…³é”®è¯ï¼Œæ”¯æŒæ–‡ä»¶åå’Œæ–‡ä»¶å¤¹åæœç´¢</li>
                        <li><strong>å…¨å±€æœç´¢</strong>ï¼šæœç´¢èŒƒå›´è¦†ç›–æ•´ä¸ªé€‰æ‹©çš„ç£ç›˜</li>
                        <li><strong>å¿«é€Ÿè·³è½¬</strong>ï¼šç‚¹å‡»æœç´¢ç»“æœå¯ç›´æ¥è·³è½¬åˆ°å¯¹åº”ä½ç½®</li>
                    </ul>
                </div>
                
                <div class="help-section">
                    <h3>ğŸ“ å¯¼èˆªåŠŸèƒ½</h3>
                    <ul>
                        <li><strong>æ–‡ä»¶å¤¹æ ‘</strong>ï¼šå·¦ä¾§æ˜¾ç¤ºå±‚çº§ç»“æ„ï¼Œç‚¹å‡»å¯è¿›å…¥å¯¹åº”æ–‡ä»¶å¤¹</li>
                        <li><strong>é¢åŒ…å±‘å¯¼èˆª</strong>ï¼šé¡¶éƒ¨æ˜¾ç¤ºå½“å‰è·¯å¾„ï¼Œç‚¹å‡»ä»»æ„éƒ¨åˆ†å¯å¿«é€Ÿè·³è½¬</li>
                        <li><strong>è¿”å›æŒ‰é’®</strong>ï¼šä½¿ç”¨"â¬…ï¸ è¿”å›"æŒ‰é’®è¿”å›ä¸Šçº§ç›®å½•</li>
                    </ul>
                </div>
                
                <div class="help-section">
                    <h3>âœ… æ–‡ä»¶é€‰æ‹©</h3>
                    <h4>å•ä¸ªé€‰æ‹©</h4>
                    <ul>
                        <li>ç›´æ¥ç‚¹å‡»æ–‡ä»¶å‰çš„å¤é€‰æ¡†</li>
                        <li>ç‚¹å‡»æ–‡ä»¶è¡Œä¹Ÿå¯ä»¥é€‰æ‹©/å–æ¶ˆé€‰æ‹©</li>
                    </ul>
                    
                    <h4>æ‰¹é‡é€‰æ‹©</h4>
                    <ul>
                        <li><strong>Shift + ç‚¹å‡»</strong>ï¼šé€‰æ‹©ä¸¤ä¸ªæ–‡ä»¶ä¹‹é—´çš„æ‰€æœ‰æ–‡ä»¶</li>
                        <li><strong>æ‹–æ‹½é€‰æ‹©</strong>ï¼šæŒ‰ä½é¼ æ ‡å·¦é”®æ‹–æ‹½é€‰æ‹©èŒƒå›´</li>
                        <li><strong>è‡ªåŠ¨æ»šåŠ¨</strong>ï¼šæ‹–æ‹½åˆ°åº•éƒ¨/é¡¶éƒ¨æ—¶è‡ªåŠ¨æ»šåŠ¨å¹¶é€‰æ‹©æ›´å¤šæ–‡ä»¶</li>
                    </ul>
                    
                    <h4>ç´¯ç§¯é€‰æ‹©</h4>
                    <ul>
                        <li>æŒ‰ä½Shifté”®ï¼Œå¯ä»¥å¤šæ¬¡é€‰æ‹©ä¸åŒèŒƒå›´çš„æ–‡ä»¶</li>
                        <li>ä¹‹å‰é€‰æ‹©çš„æ–‡ä»¶ä¼šä¿ç•™ï¼Œæ–°é€‰æ‹©ä¼šæ·»åŠ åˆ°ç°æœ‰é€‰æ‹©ä¸­</li>
                    </ul>
                </div>
                
                <div class="help-section">
                    <h3>ğŸ”„ æ‰¹é‡æ“ä½œ</h3>
                    <p>é€‰æ‹©æ–‡ä»¶åï¼Œåº•éƒ¨ä¼šæ˜¾ç¤ºæ‰¹é‡æ“ä½œæ ï¼š</p>
                    <ul>
                        <li><strong>å…¨é€‰</strong>ï¼šé€‰æ‹©å½“å‰æ–‡ä»¶å¤¹ä¸­çš„æ‰€æœ‰æ–‡ä»¶</li>
                        <li><strong>å–æ¶ˆå…¨é€‰</strong>ï¼šå–æ¶ˆæ‰€æœ‰é€‰æ‹©</li>
                        <li><strong>æ‰¹é‡è½¬ç§»</strong>ï¼šå°†é€‰ä¸­çš„æ–‡ä»¶ç§»åŠ¨åˆ°å…¶ä»–æ–‡ä»¶å¤¹</li>
                    </ul>
                </div>
                
                <div class="help-section">
                    <h3>ğŸ“Š ç»Ÿè®¡ä¿¡æ¯</h3>
                    <p>é¡µé¢é¡¶éƒ¨æ˜¾ç¤ºä¸‰ä¸ªç»Ÿè®¡å¡ç‰‡ï¼š</p>
                    <ul>
                        <li><strong>æ–‡ä»¶å¤¹æ•°</strong>ï¼šæ‰«æåˆ°çš„æ–‡ä»¶å¤¹æ€»æ•°</li>
                        <li><strong>æ–‡ä»¶æ•°</strong>ï¼šæ‰«æåˆ°çš„æ–‡ä»¶æ€»æ•°</li>
                        <li><strong>å±‚çº§æ·±åº¦</strong>ï¼šæ–‡ä»¶å¤¹çš„æœ€å¤§åµŒå¥—å±‚çº§</li>
                    </ul>
                </div>
                
                <div class="help-section">
                    <h3>ğŸ¨ ç•Œé¢è¯´æ˜</h3>
                    <ul>
                        <li><strong>å¤§æ ‡ç­¾</strong>ï¼šç¬¬ä¸€çº§æ–‡ä»¶å¤¹ï¼ˆç´«è‰²æ¸å˜ï¼‰</li>
                        <li><strong>ä¸­æ ‡ç­¾</strong>ï¼šç¬¬äºŒçº§æ–‡ä»¶å¤¹ï¼ˆé’ç»¿è‰²æ¸å˜ï¼‰</li>
                        <li><strong>å°æ ‡ç­¾</strong>ï¼šç¬¬ä¸‰çº§æ–‡ä»¶å¤¹ï¼ˆæ©™çº¢è‰²æ¸å˜ï¼‰</li>
                        <li><strong>å¾®æ ‡ç­¾</strong>ï¼šç¬¬å››çº§åŠä»¥ä¸‹æ–‡ä»¶å¤¹ï¼ˆé»„ç»¿è‰²æ¸å˜ï¼‰</li>
                    </ul>
                </div>
                
                <div class="help-section">
                    <h3>ğŸ’¡ ä½¿ç”¨æŠ€å·§</h3>
                    <ul>
                        <li><strong>å¿«é€Ÿå®šä½</strong>ï¼šä½¿ç”¨æœç´¢åŠŸèƒ½å¿«é€Ÿæ‰¾åˆ°ç›®æ ‡æ–‡ä»¶</li>
                        <li><strong>æ‰¹é‡æ•´ç†</strong>ï¼šé€‰æ‹©å¤šä¸ªæ–‡ä»¶åä½¿ç”¨æ‰¹é‡è½¬ç§»åŠŸèƒ½æ•´ç†æ–‡ä»¶</li>
                        <li><strong>å±‚çº§æµè§ˆ</strong>ï¼šåˆ©ç”¨é¢åŒ…å±‘å¯¼èˆªå¿«é€Ÿåœ¨ä¸åŒå±‚çº§é—´è·³è½¬</li>
                        <li><strong>æ™ºèƒ½é€‰æ‹©</strong>ï¼šä½¿ç”¨Shifté”®å’Œæ‹–æ‹½åŠŸèƒ½é«˜æ•ˆé€‰æ‹©å¤§é‡æ–‡ä»¶</li>
                    </ul>
                </div>
                
                <div class="help-section">
                    <h3>âš ï¸ æ³¨æ„äº‹é¡¹</h3>
                    <ul>
                        <li>æœ¬å·¥å…·ä½¿ç”¨æµè§ˆå™¨æ–‡ä»¶ç³»ç»ŸAPIï¼Œéœ€è¦ç°ä»£æµè§ˆå™¨æ”¯æŒ</li>
                        <li>å»ºè®®ä½¿ç”¨Chromeã€Edgeæˆ–Firefoxæœ€æ–°ç‰ˆæœ¬</li>
                        <li>æ–‡ä»¶æ“ä½œä¼šç›´æ¥ä¿®æ”¹æœ¬åœ°æ–‡ä»¶ï¼Œè¯·è°¨æ…æ“ä½œ</li>
                        <li>æ‰¹é‡è½¬ç§»å‰è¯·ç¡®è®¤ç›®æ ‡æ–‡ä»¶å¤¹ä½ç½®æ­£ç¡®</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentDirHandle = null;
        let folderStructure = null;
        let currentPath = [];
        let selectedFiles = new Set();
        let targetFolderHandle = null;
        let navigationHistory = [];
        let currentHistoryIndex = -1;
        let lastSelectedFile = null;
        let isShiftPressed = false;
        
        // é”®ç›˜äº‹ä»¶ç›‘å¬
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Shift') {
                isShiftPressed = true;
            }
        });
        
        document.addEventListener('keyup', function(e) {
            if (e.key === 'Shift') {
                isShiftPressed = false;
            }
        });
        
        // æœç´¢åŠŸèƒ½
        document.querySelector('.search-input').addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            if (searchTerm.length > 0) {
                searchFiles(searchTerm);
            } else {
                // å¦‚æœæœç´¢æ¡†ä¸ºç©ºï¼Œæ˜¾ç¤ºå½“å‰æ–‡ä»¶å¤¹å†…å®¹
                if (navigationHistory.length > 0) {
                    const currentNode = navigationHistory[currentHistoryIndex];
                    if (currentNode) {
                        displayCurrentFolder(currentNode);
                    }
                }
            }
        });
        
        // æœç´¢æ–‡ä»¶ - æ”¯æŒæ•´ä¸ªç£ç›˜æœç´¢
        function searchFiles(searchTerm) {
            if (!folderStructure) return;
            
            const results = [];
            searchInNode(folderStructure, searchTerm, results);
            
            const container = document.getElementById('currentFolder');
            if (results.length === 0) {
                container.innerHTML = `<div class="loading">æœªæ‰¾åˆ°åŒ…å« "${searchTerm}" çš„æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹</div>`;
                return;
            }
            
            let html = `<h3>ğŸ” æœç´¢ç»“æœ: "${searchTerm}" (${results.length}é¡¹)</h3>`;
            
            results.forEach(item => {
                const icon = item.type === 'folder' ? 'ğŸ“' : 'ğŸ“„';
                const path = getItemPath(item);
                html += `
                    <div class="file-item" onclick="navigateToItem('${item.id}')">
                        <div class="file-info">
                            <span class="file-icon">${icon}</span>
                            <span>${item.name}</span>
                            <small style="color: #666; margin-left: 10px;">${path}</small>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        // åœ¨èŠ‚ç‚¹ä¸­æœç´¢ - é€’å½’æœç´¢æ•´ä¸ªç£ç›˜
        function searchInNode(node, searchTerm, results) {
            if (node.name.toLowerCase().includes(searchTerm)) {
                results.push(node);
            }
            
            if (node.children) {
                node.children.forEach(child => {
                    searchInNode(child, searchTerm, results);
                });
            }
        }
        
        // è·å–é¡¹ç›®å®Œæ•´è·¯å¾„
        function getItemPath(item) {
            const path = [];
            let current = item;
            while (current && current.name) {
                path.unshift(current.name);
                current = current.parent;
            }
            return path.join(' > ');
        }
        
        // è¿”å›ä¸Šä¸€çº§
        function goBack() {
            if (currentHistoryIndex > 0) {
                currentHistoryIndex--;
                const previousNode = navigationHistory[currentHistoryIndex];
                if (previousNode) {
                    displayCurrentFolder(previousNode);
                    updateBreadcrumb(previousNode);
                    updateBackButton();
                }
            }
        }
        
        // æ›´æ–°è¿”å›æŒ‰é’®çŠ¶æ€
        function updateBackButton() {
            const backBtn = document.querySelector('.back-btn');
            if (currentHistoryIndex > 0) {
                backBtn.style.display = 'block';
            } else {
                backBtn.style.display = 'none';
            }
        }
        
        // å¯¼èˆªåˆ°æŒ‡å®šé¡¹ç›®
        function navigateToItem(itemId) {
            const item = findNodeById(folderStructure, itemId);
            if (item) {
                if (item.type === 'folder') {
                    // æ„å»ºåˆ°ç›®æ ‡æ–‡ä»¶å¤¹çš„å®Œæ•´è·¯å¾„
                    const pathToTarget = [];
                    let current = item;
                    while (current && current.name) {
                        pathToTarget.unshift(current);
                        current = current.parent;
                    }
                    
                    // æ¸…ç©ºå½“å‰å†å²ï¼Œé‡æ–°æ„å»º
                    navigationHistory = [];
                    currentHistoryIndex = -1;
                    
                    // é€çº§æ·»åŠ åˆ°å†å²è®°å½•
                    pathToTarget.forEach((pathNode, index) => {
                        navigationHistory.push(pathNode);
                        currentHistoryIndex = index;
                    });
                    
                    displayCurrentFolder(item);
                    updateBreadcrumb(item);
                    updateBackButton();
                } else {
                    openFile(itemId);
                }
            }
        }
        
        // é€‰æ‹©æ–‡ä»¶å¤¹
        async function selectFolder() {
            try {
                const dirHandle = await window.showDirectoryPicker();
                currentDirHandle = dirHandle;
                currentPath = [dirHandle.name];
                
                updateCurrentPath();
                showLoading('æ­£åœ¨æ‰«ææ–‡ä»¶å¤¹ç»“æ„...');
                
                folderStructure = await scanDirectory(dirHandle, 0);
                displayFolderTree(folderStructure);
                displayCurrentFolder(folderStructure);
                updateStats(folderStructure);
                
                showSuccess('æ–‡ä»¶å¤¹æ‰«æå®Œæˆï¼');
                
            } catch (error) {
                console.error('é€‰æ‹©æ–‡ä»¶å¤¹å¤±è´¥:', error);
                if (error.name === 'AbortError') {
                    showError('ç”¨æˆ·å–æ¶ˆäº†æ–‡ä»¶å¤¹é€‰æ‹©');
                } else {
                    showError('é€‰æ‹©æ–‡ä»¶å¤¹å¤±è´¥: ' + error.message);
                }
            }
        }
        
        // æ‰«æç›®å½•ç»“æ„
        async function scanDirectory(dirHandle, level = 0, parent = null) {
            const result = {
                id: generateId(),
                name: dirHandle.name,
                path: dirHandle.path || '',
                type: 'folder',
                children: [],
                level: level,
                handle: dirHandle,
                parent: parent
            };
            
            try {
                for await (const entry of dirHandle.values()) {
                    if (entry.kind === 'directory') {
                        const child = await scanDirectory(entry, level + 1, result);
                        result.children.push(child);
                    } else if (isBookFile(entry.name)) {
                        result.children.push({
                            id: generateId(),
                            name: entry.name,
                            type: 'file',
                            level: level + 1,
                            handle: entry,
                            parent: result
                        });
                    }
                }
            } catch (error) {
                console.warn('æ‰«ææ–‡ä»¶å¤¹å¤±è´¥:', dirHandle.name, error);
            }
            
            return result;
        }
        
        // åˆ¤æ–­æ˜¯å¦ä¸ºä¹¦ç±æ–‡ä»¶ï¼ˆç°åœ¨æ”¯æŒæ‰€æœ‰æ–‡ä»¶ï¼‰
        function isBookFile(filename) {
            // æ”¯æŒæ‰€æœ‰æ–‡ä»¶ç±»å‹
            return true;
        }
        
        // ç”Ÿæˆå”¯ä¸€ID
        function generateId() {
            return 'id_' + Math.random().toString(36).substr(2, 9);
        }
        
        // æ˜¾ç¤ºæ–‡ä»¶å¤¹æ ‘
        function displayFolderTree(structure) {
            const treeContainer = document.getElementById('folderTree');
            
            function renderNode(node) {
                const tagType = getTagType(node.level);
                const className = `tag-${Math.min(node.level, 3)}`;
                
                let childrenHtml = '';
                if (node.children && node.children.length > 0) {
                    childrenHtml = node.children.map(child => renderNode(child)).join('');
                }
                
                return `
                    <div class="folder-node ${className}" onclick="selectNode('${node.id}')" data-id="${node.id}">
                        <span class="tag-type">${tagType}</span>
                        <span class="folder-name">${node.name}</span>
                        ${node.children ? `<span class="file-count">(${node.children.length})</span>` : ''}
                    </div>
                    ${childrenHtml}
                `;
            }
            
            treeContainer.innerHTML = renderNode(structure);
        }
        
        // è·å–æ ‡ç­¾ç±»å‹
        function getTagType(level) {
            const types = ['å¤§æ ‡ç­¾', 'ä¸­æ ‡ç­¾', 'å°æ ‡ç­¾', 'å¾®æ ‡ç­¾'];
            return types[Math.min(level, types.length - 1)];
        }
        
        // é€‰æ‹©èŠ‚ç‚¹
        function selectNode(nodeId) {
            const node = findNodeById(folderStructure, nodeId);
            if (node) {
                // æ·»åŠ åˆ°å¯¼èˆªå†å²
                navigationHistory.push(node);
                currentHistoryIndex++;
                
                displayCurrentFolder(node);
                updateBreadcrumb(node);
                updateBackButton();
            }
        }
        
        // æ ¹æ®IDæŸ¥æ‰¾èŠ‚ç‚¹
        function findNodeById(structure, id) {
            if (structure.id === id) {
                return structure;
            }
            
            if (structure.children) {
                for (const child of structure.children) {
                    const found = findNodeById(child, id);
                    if (found) return found;
                }
            }
            
            return null;
        }
        
        // æ˜¾ç¤ºå½“å‰æ–‡ä»¶å¤¹å†…å®¹
        function displayCurrentFolder(node) {
            const container = document.getElementById('currentFolder');
            
            if (!node.children || node.children.length === 0) {
                container.innerHTML = '<div class="loading">æ­¤æ–‡ä»¶å¤¹ä¸ºç©º</div>';
                return;
            }
            
            let html = `<h3>ğŸ“ ${node.name} çš„å†…å®¹</h3>`;
            
            // åˆ†ç±»æ˜¾ç¤º
            const folders = node.children.filter(item => item.type === 'folder');
            const files = node.children.filter(item => item.type === 'file');
            
            if (folders.length > 0) {
                html += '<h4>ğŸ“‚ å­æ–‡ä»¶å¤¹</h4>';
                folders.forEach(folder => {
                    html += `
                        <div class="folder-node tag-${Math.min(folder.level, 3)}" onclick="selectNode('${folder.id}')">
                            ğŸ“ ${folder.name} (${folder.children ? folder.children.length : 0}é¡¹)
                        </div>
                    `;
                });
            }
            
            if (files.length > 0) {
                html += '<h4>ğŸ“„ æ–‡ä»¶åˆ—è¡¨</h4>';
                files.forEach((file, index) => {
                    const isSelected = selectedFiles.has(file.id);
                    const selectedClass = isSelected ? 'selected' : '';
                    html += `
                        <div class="file-item ${selectedClass}" data-file-id="${file.id}" data-file-index="${index}">
                            <div class="file-info">
                                <input type="checkbox" class="file-checkbox" id="file_${file.id}" 
                                       ${isSelected ? 'checked' : ''}>
                                <span class="file-icon">ğŸ“„</span>
                                <span>${file.name}</span>
                            </div>
                        </div>
                    `;
                });
            }
            
            container.innerHTML = html;
            
            // æ·»åŠ æ»‘åŠ¨å¤šé€‰äº‹ä»¶
            addDragSelection();
        }
        
        // æ‰“å¼€æ–‡ä»¶
        async function openFile(fileId) {
            const node = findNodeById(folderStructure, fileId);
            if (node && node.handle) {
                try {
                    const file = await node.handle.getFile();
                    const url = URL.createObjectURL(file);
                    window.open(url, '_blank');
                } catch (error) {
                    showError('æ— æ³•æ‰“å¼€æ–‡ä»¶: ' + error.message);
                }
            }
        }
        
        // æ›´æ–°é¢åŒ…å±‘
        function updateBreadcrumb(node) {
            const breadcrumb = document.getElementById('breadcrumb');
            breadcrumb.style.display = 'block';
            
            // æ„å»ºä»æ ¹ç›®å½•åˆ°å½“å‰èŠ‚ç‚¹çš„å®Œæ•´è·¯å¾„
            const path = [];
            let current = node;
            while (current) {
                path.unshift(current);
                current = current.parent;
            }
            
            let html = '';
            path.forEach((pathNode, index) => {
                if (index > 0) {
                    html += '<span class="separator">></span>';
                }
                html += `<span onclick="navigateToPathNode('${pathNode.id}')" style="cursor: pointer; color: #667eea;">${pathNode.name}</span>`;
            });
            
            breadcrumb.innerHTML = html;
        }
        
        // å¯¼èˆªåˆ°æŒ‡å®šçš„è·¯å¾„èŠ‚ç‚¹
        function navigateToPathNode(nodeId) {
            const targetNode = findNodeById(folderStructure, nodeId);
            if (targetNode) {
                // æ„å»ºåˆ°ç›®æ ‡èŠ‚ç‚¹çš„å®Œæ•´è·¯å¾„
                const pathToTarget = [];
                let current = targetNode;
                while (current) {
                    pathToTarget.unshift(current);
                    current = current.parent;
                }
                
                // æ¸…ç©ºå½“å‰å†å²ï¼Œé‡æ–°æ„å»º
                navigationHistory = [];
                currentHistoryIndex = -1;
                
                // é€çº§æ·»åŠ åˆ°å†å²è®°å½•
                pathToTarget.forEach((pathNode, index) => {
                    navigationHistory.push(pathNode);
                    currentHistoryIndex = index;
                });
                
                displayCurrentFolder(targetNode);
                updateBreadcrumb(targetNode);
                updateBackButton();
            }
        }
        
        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats(structure) {
            const stats = document.getElementById('stats');
            stats.style.display = 'grid';
            
            const folderCount = countFolders(structure);
            const fileCount = countFiles(structure);
            const levelCount = getMaxLevel(structure);
            
            document.getElementById('folderCount').textContent = folderCount;
            document.getElementById('fileCount').textContent = fileCount;
            document.getElementById('levelCount').textContent = levelCount;
        }
        
        // ç»Ÿè®¡æ–‡ä»¶å¤¹æ•°é‡
        function countFolders(node) {
            let count = 1; // å½“å‰èŠ‚ç‚¹
            if (node.children) {
                node.children.forEach(child => {
                    if (child.type === 'folder') {
                        count += countFolders(child);
                    }
                });
            }
            return count;
        }
        
        // ç»Ÿè®¡æ–‡ä»¶æ•°é‡
        function countFiles(node) {
            let count = 0;
            if (node.children) {
                node.children.forEach(child => {
                    if (child.type === 'file') {
                        count++;
                    } else {
                        count += countFiles(child);
                    }
                });
            }
            return count;
        }
        
        // è·å–æœ€å¤§å±‚çº§
        function getMaxLevel(node) {
            let maxLevel = node.level;
            if (node.children) {
                node.children.forEach(child => {
                    maxLevel = Math.max(maxLevel, getMaxLevel(child));
                });
            }
            return maxLevel + 1;
        }
        
        // æ›´æ–°å½“å‰è·¯å¾„æ˜¾ç¤º
        function updateCurrentPath() {
            const pathElement = document.getElementById('currentPath');
            pathElement.textContent = currentPath.join(' > ');
        }
        
        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        function showLoading(message) {
            const container = document.getElementById('currentFolder');
            container.innerHTML = `<div class="loading">${message}</div>`;
        }
        
        // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
        function showSuccess(message) {
            const container = document.getElementById('currentFolder');
            container.innerHTML = `<div class="success">${message}</div>`;
        }
        
        // æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
        function showError(message) {
            const container = document.getElementById('currentFolder');
            container.innerHTML = `<div class="error">${message}</div>`;
        }
        
        // åˆ‡æ¢æ–‡ä»¶é€‰æ‹©çŠ¶æ€
        function toggleFileSelection(fileId, event) {
            if (event) {
                event.stopPropagation();
            }
            
            const fileItem = document.querySelector(`[data-file-id="${fileId}"]`);
            
            if (selectedFiles.has(fileId)) {
                selectedFiles.delete(fileId);
                fileItem.classList.remove('selected');
            } else {
                selectedFiles.add(fileId);
                fileItem.classList.add('selected');
            }
            
            lastSelectedFile = fileId;
            updateBatchActions();
        }
        
        // æ›´æ–°æ‰¹é‡æ“ä½œæ 
        function updateBatchActions() {
            const batchActions = document.getElementById('batchActions');
            const selectedCount = document.getElementById('selectedCount');
            
            console.log('æ›´æ–°æ‰¹é‡æ“ä½œæ ï¼Œé€‰æ‹©çš„æ–‡ä»¶æ•°é‡:', selectedFiles.size);
            
            if (selectedFiles.size > 0) {
                batchActions.classList.add('show');
                selectedCount.textContent = `å·²é€‰æ‹© ${selectedFiles.size} ä¸ªæ–‡ä»¶`;
                console.log('æ˜¾ç¤ºæ‰¹é‡æ“ä½œæ ');
            } else {
                batchActions.classList.remove('show');
                console.log('éšè—æ‰¹é‡æ“ä½œæ ');
            }
        }
        
        // å…¨é€‰æ–‡ä»¶
        function selectAllFiles() {
            const checkboxes = document.querySelectorAll('.file-checkbox');
            checkboxes.forEach(checkbox => {
                checkbox.checked = true;
                const fileId = checkbox.id.replace('file_', '');
                selectedFiles.add(fileId);
            });
            updateBatchActions();
        }
        
        // å–æ¶ˆå…¨é€‰
        function deselectAllFiles() {
            const checkboxes = document.querySelectorAll('.file-checkbox');
            checkboxes.forEach(checkbox => {
                checkbox.checked = false;
            });
            selectedFiles.clear();
            updateBatchActions();
        }
        
        // æ˜¾ç¤ºè½¬ç§»å¯¹è¯æ¡†
        function showMoveDialog() {
            if (selectedFiles.size === 0) {
                alert('è¯·å…ˆé€‰æ‹©è¦è½¬ç§»çš„æ–‡ä»¶');
                return;
            }
            
            document.getElementById('moveDialog').classList.add('show');
            targetFolderHandle = null;
            document.getElementById('targetFolderPath').style.display = 'none';
            document.getElementById('progressBar').style.display = 'none';
            document.getElementById('moveStatus').innerHTML = '';
        }
        
        // é€‰æ‹©ç›®æ ‡æ–‡ä»¶å¤¹
        async function selectTargetFolder() {
            try {
                const dirHandle = await window.showDirectoryPicker();
                targetFolderHandle = dirHandle;
                document.getElementById('targetFolderPath').textContent = dirHandle.name;
                document.getElementById('targetFolderPath').style.display = 'block';
            } catch (error) {
                if (error.name !== 'AbortError') {
                    alert('é€‰æ‹©ç›®æ ‡æ–‡ä»¶å¤¹å¤±è´¥: ' + error.message);
                }
            }
        }
        
        // å…³é—­è½¬ç§»å¯¹è¯æ¡†
        function closeMoveDialog() {
            document.getElementById('moveDialog').classList.remove('show');
            targetFolderHandle = null;
        }
        
        // æ‰§è¡Œæ–‡ä»¶è½¬ç§»
        async function executeMove() {
            if (!targetFolderHandle) {
                alert('è¯·å…ˆé€‰æ‹©ç›®æ ‡æ–‡ä»¶å¤¹');
                return;
            }
            
            const confirmBtn = document.getElementById('confirmMoveBtn');
            const progressBar = document.getElementById('progressBar');
            const progressFill = document.getElementById('progressFill');
            const moveStatus = document.getElementById('moveStatus');
            
            confirmBtn.disabled = true;
            progressBar.style.display = 'block';
            moveStatus.innerHTML = '<p>æ­£åœ¨è½¬ç§»æ–‡ä»¶...</p>';
            
            let successCount = 0;
            let failCount = 0;
            const totalFiles = selectedFiles.size;
            let currentIndex = 0;
            
            for (const fileId of selectedFiles) {
                try {
                    const fileNode = findNodeById(folderStructure, fileId);
                    if (fileNode && fileNode.handle) {
                        // è·å–æºæ–‡ä»¶
                        const sourceFile = await fileNode.handle.getFile();
                        
                        // æ£€æŸ¥ç›®æ ‡æ–‡ä»¶å¤¹ä¸­æ˜¯å¦å·²å­˜åœ¨åŒåæ–‡ä»¶
                        let targetFileName = fileNode.name;
                        let counter = 1;
                        
                        while (true) {
                            try {
                                await targetFolderHandle.getFileHandle(targetFileName);
                                // æ–‡ä»¶å·²å­˜åœ¨ï¼Œé‡å‘½å
                                const nameParts = fileNode.name.split('.');
                                const ext = nameParts.pop();
                                const baseName = nameParts.join('.');
                                targetFileName = `${baseName}_${counter}.${ext}`;
                                counter++;
                            } catch {
                                // æ–‡ä»¶ä¸å­˜åœ¨ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªåç§°
                                break;
                            }
                        }
                        
                        // åˆ›å»ºæ–°æ–‡ä»¶
                        const targetFileHandle = await targetFolderHandle.getFileHandle(targetFileName, { create: true });
                        const writable = await targetFileHandle.createWritable();
                        
                        // å†™å…¥æ–‡ä»¶å†…å®¹
                        await writable.write(sourceFile);
                        await writable.close();
                        
                        // åˆ é™¤åŸæ–‡ä»¶
                        await fileNode.handle.remove();
                        
                        successCount++;
                    }
                } catch (error) {
                    console.error('è½¬ç§»æ–‡ä»¶å¤±è´¥:', error);
                    failCount++;
                }
                
                currentIndex++;
                const progress = (currentIndex / totalFiles) * 100;
                progressFill.style.width = progress + '%';
                
                moveStatus.innerHTML = `
                    <p>æ­£åœ¨è½¬ç§»æ–‡ä»¶... (${currentIndex}/${totalFiles})</p>
                    <p>æˆåŠŸ: ${successCount}, å¤±è´¥: ${failCount}</p>
                `;
            }
            
            // è½¬ç§»å®Œæˆ
            moveStatus.innerHTML = `
                <div class="success">
                    <p>è½¬ç§»å®Œæˆï¼</p>
                    <p>æˆåŠŸ: ${successCount} ä¸ªæ–‡ä»¶</p>
                    <p>å¤±è´¥: ${failCount} ä¸ªæ–‡ä»¶</p>
                </div>
            `;
            
            // é‡æ–°æ‰«ææ–‡ä»¶å¤¹ç»“æ„
            if (currentDirHandle) {
                folderStructure = await scanDirectory(currentDirHandle, 0);
                displayFolderTree(folderStructure);
                displayCurrentFolder(folderStructure);
                updateStats(folderStructure);
            }
            
            // æ¸…ç©ºé€‰æ‹©
            selectedFiles.clear();
            updateBatchActions();
            
            // 3ç§’åå…³é—­å¯¹è¯æ¡†
            setTimeout(() => {
                closeMoveDialog();
            }, 3000);
        }
        
        // æ·»åŠ æ»‘åŠ¨å¤šé€‰åŠŸèƒ½
        function addDragSelection() {
            const fileItems = document.querySelectorAll('.file-item');
            let isDragging = false;
            let startItem = null;
            let endItem = null;
            let lastSelectedIndex = -1;
            let dragStartTime = 0;
            let isNewSelection = false; // æ ‡è®°æ˜¯å¦æ˜¯æ–°çš„ä¸€æ¬¡é€‰æ‹©
            
            fileItems.forEach((item, index) => {
                item.addEventListener('mousedown', function(e) {
                    if (e.target.classList.contains('file-checkbox')) return;
                    
                    const currentIndex = parseInt(this.dataset.fileIndex);
                    const currentTime = Date.now();
                    
                    // åˆ¤æ–­æ˜¯å¦æ˜¯æ–°çš„ä¸€æ¬¡é€‰æ‹©ï¼ˆæ—¶é—´é—´éš”å¤§äº200msæˆ–æ²¡æœ‰æŒ‰ä½Shifté”®ï¼‰
                    if (currentTime - dragStartTime > 200 || !isShiftPressed) {
                        isNewSelection = true;
                        // å¦‚æœæ˜¯æ–°é€‰æ‹©ä¸”æ²¡æœ‰æŒ‰Shifté”®ï¼Œæ¸…ç©ºä¹‹å‰çš„é€‰æ‹©
                        if (!isShiftPressed) {
                            selectedFiles.clear();
                            document.querySelectorAll('.file-item').forEach(item => {
                                item.classList.remove('selected');
                                item.querySelector('.file-checkbox').checked = false;
                            });
                        }
                    } else {
                        isNewSelection = false;
                    }
                    
                    dragStartTime = currentTime;
                    
                    // å¦‚æœæŒ‰ä½Shifté”®ï¼Œè¿›è¡ŒèŒƒå›´é€‰æ‹©
                    if (isShiftPressed && lastSelectedIndex !== -1 && !isNewSelection) {
                        const minIndex = Math.min(currentIndex, lastSelectedIndex);
                        const maxIndex = Math.max(currentIndex, lastSelectedIndex);
                        
                        // ä¸æ¸…ç©ºä¹‹å‰çš„é€‰æ‹©ï¼Œè€Œæ˜¯æ·»åŠ åˆ°ç°æœ‰é€‰æ‹©ä¸­
                        for (let i = minIndex; i <= maxIndex; i++) {
                            const targetItem = document.querySelector(`[data-file-index="${i}"]`);
                            if (targetItem) {
                                const fileId = targetItem.dataset.fileId;
                                selectedFiles.add(fileId);
                                targetItem.classList.add('selected');
                                targetItem.querySelector('.file-checkbox').checked = true;
                            }
                        }
                        updateBatchActions();
                    } else {
                        // æ™®é€šç‚¹å‡»é€‰æ‹©
                        const fileId = this.dataset.fileId;
                        if (selectedFiles.has(fileId)) {
                            selectedFiles.delete(fileId);
                            this.classList.remove('selected');
                            this.querySelector('.file-checkbox').checked = false;
                        } else {
                            selectedFiles.add(fileId);
                            this.classList.add('selected');
                            this.querySelector('.file-checkbox').checked = true;
                        }
                        updateBatchActions();
                    }
                    
                    lastSelectedIndex = currentIndex;
                    isDragging = true;
                    startItem = this;
                    this.classList.add('selecting');
                });
                
                item.addEventListener('mouseenter', function(e) {
                    if (isDragging && this !== startItem) {
                        endItem = this;
                        this.classList.add('selecting');
                    }
                });
            });
            
            // ç›‘å¬é¼ æ ‡ç§»åŠ¨ï¼Œå®ç°è‡ªåŠ¨æ»šåŠ¨é€‰æ‹©
            const mainContent = document.querySelector('.main-content');
            let autoScrollInterval = null;
            
            // åœ¨æ•´ä¸ªæ–‡æ¡£ä¸Šç›‘å¬é¼ æ ‡ç§»åŠ¨ï¼Œç¡®ä¿å³ä½¿æ»‘å‡ºåˆ—è¡¨åŒºåŸŸä¹Ÿèƒ½ç»§ç»­é€‰æ‹©
            document.addEventListener('mousemove', function(e) {
                if (isDragging && startItem && lastSelectedIndex !== -1) {
                    const rect = mainContent.getBoundingClientRect();
                    const mouseY = e.clientY - rect.top;
                    const containerHeight = rect.height;
                    
                    // å¦‚æœé¼ æ ‡åœ¨åº•éƒ¨åŒºåŸŸï¼Œè‡ªåŠ¨å‘ä¸‹æ»šåŠ¨
                    if (mouseY > containerHeight - 50) {
                        if (!autoScrollInterval) {
                            autoScrollInterval = setInterval(() => {
                                const currentScrollTop = mainContent.scrollTop;
                                mainContent.scrollTop = currentScrollTop + 10;
                                
                                // æ‰¾åˆ°å½“å‰å¯è§åŒºåŸŸçš„æ–‡ä»¶
                                const visibleItems = Array.from(fileItems).filter(item => {
                                    const itemRect = item.getBoundingClientRect();
                                    const containerRect = mainContent.getBoundingClientRect();
                                    return itemRect.top >= containerRect.top && itemRect.bottom <= containerRect.bottom;
                                });
                                
                                if (visibleItems.length > 0) {
                                    const lastVisibleIndex = parseInt(visibleItems[visibleItems.length - 1].dataset.fileIndex);
                                    if (lastVisibleIndex > lastSelectedIndex) {
                                        // æ‰©å±•é€‰æ‹©èŒƒå›´ï¼Œä¸æ¸…ç©ºä¹‹å‰çš„é€‰æ‹©
                                        const minIndex = Math.min(lastSelectedIndex, lastVisibleIndex);
                                        const maxIndex = Math.max(lastSelectedIndex, lastVisibleIndex);
                                        
                                        // é€‰æ‹©èŒƒå›´å†…çš„æ‰€æœ‰æ–‡ä»¶ï¼Œæ·»åŠ åˆ°ç°æœ‰é€‰æ‹©ä¸­
                                        for (let i = minIndex; i <= maxIndex; i++) {
                                            const targetItem = document.querySelector(`[data-file-index="${i}"]`);
                                            if (targetItem) {
                                                const fileId = targetItem.dataset.fileId;
                                                selectedFiles.add(fileId);
                                                targetItem.classList.add('selected');
                                                targetItem.querySelector('.file-checkbox').checked = true;
                                            }
                                        }
                                        updateBatchActions();
                                    }
                                }
                            }, 100);
                        }
                    } else if (mouseY < 50) {
                        // å¦‚æœé¼ æ ‡åœ¨é¡¶éƒ¨åŒºåŸŸï¼Œè‡ªåŠ¨å‘ä¸Šæ»šåŠ¨
                        if (!autoScrollInterval) {
                            autoScrollInterval = setInterval(() => {
                                const currentScrollTop = mainContent.scrollTop;
                                mainContent.scrollTop = currentScrollTop - 10;
                                
                                // æ‰¾åˆ°å½“å‰å¯è§åŒºåŸŸçš„æ–‡ä»¶
                                const visibleItems = Array.from(fileItems).filter(item => {
                                    const itemRect = item.getBoundingClientRect();
                                    const containerRect = mainContent.getBoundingClientRect();
                                    return itemRect.top >= containerRect.top && itemRect.bottom <= containerRect.bottom;
                                });
                                
                                if (visibleItems.length > 0) {
                                    const firstVisibleIndex = parseInt(visibleItems[0].dataset.fileIndex);
                                    if (firstVisibleIndex < lastSelectedIndex) {
                                        // æ‰©å±•é€‰æ‹©èŒƒå›´ï¼Œä¸æ¸…ç©ºä¹‹å‰çš„é€‰æ‹©
                                        const minIndex = Math.min(lastSelectedIndex, firstVisibleIndex);
                                        const maxIndex = Math.max(lastSelectedIndex, firstVisibleIndex);
                                        
                                        // é€‰æ‹©èŒƒå›´å†…çš„æ‰€æœ‰æ–‡ä»¶ï¼Œæ·»åŠ åˆ°ç°æœ‰é€‰æ‹©ä¸­
                                        for (let i = minIndex; i <= maxIndex; i++) {
                                            const targetItem = document.querySelector(`[data-file-index="${i}"]`);
                                            if (targetItem) {
                                                const fileId = targetItem.dataset.fileId;
                                                selectedFiles.add(fileId);
                                                targetItem.classList.add('selected');
                                                targetItem.querySelector('.file-checkbox').checked = true;
                                            }
                                        }
                                        updateBatchActions();
                                    }
                                }
                            }, 100);
                        }
                    } else {
                        // é¼ æ ‡åœ¨ä¸­é—´åŒºåŸŸï¼Œåœæ­¢è‡ªåŠ¨æ»šåŠ¨
                        if (autoScrollInterval) {
                            clearInterval(autoScrollInterval);
                            autoScrollInterval = null;
                        }
                    }
                }
            });
            
            // åœ¨æ•´ä¸ªæ–‡æ¡£ä¸Šç›‘å¬é¼ æ ‡é‡Šæ”¾ï¼Œç¡®ä¿æ— è®ºåœ¨å“ªé‡Œé‡Šæ”¾éƒ½èƒ½æ­£ç¡®å®Œæˆé€‰æ‹©
            document.addEventListener('mouseup', function() {
                // åœæ­¢è‡ªåŠ¨æ»šåŠ¨
                if (autoScrollInterval) {
                    clearInterval(autoScrollInterval);
                    autoScrollInterval = null;
                }
                
                if (isDragging && startItem) {
                    // å¦‚æœæœ‰endItemï¼Œå®ŒæˆèŒƒå›´é€‰æ‹©
                    if (endItem) {
                        const startIndex = parseInt(startItem.dataset.fileIndex);
                        const endIndex = parseInt(endItem.dataset.fileIndex);
                        const minIndex = Math.min(startIndex, endIndex);
                        const maxIndex = Math.max(startIndex, endIndex);
                        
                        // ä¸æ¸…ç©ºä¹‹å‰çš„é€‰æ‹©ï¼Œè€Œæ˜¯æ·»åŠ åˆ°ç°æœ‰é€‰æ‹©ä¸­
                        for (let i = minIndex; i <= maxIndex; i++) {
                            const targetItem = document.querySelector(`[data-file-index="${i}"]`);
                            if (targetItem) {
                                const fileId = targetItem.dataset.fileId;
                                selectedFiles.add(fileId);
                                targetItem.classList.add('selected');
                                targetItem.querySelector('.file-checkbox').checked = true;
                            }
                        }
                        updateBatchActions();
                    }
                    // å¦‚æœæ²¡æœ‰endItemï¼ˆæ¯”å¦‚æ»‘å‡ºé¡µé¢ï¼‰ï¼Œè‡³å°‘ä¿ç•™å½“å‰é€‰æ‹©çš„æ–‡ä»¶
                }
                
                // æ¸…ç†çŠ¶æ€
                isDragging = false;
                document.querySelectorAll('.file-item').forEach(item => {
                    item.classList.remove('selecting');
                });
                startItem = null;
                endItem = null;
            });
        }
        
        // é¡µé¢åŠ è½½å®Œæˆ
        window.onload = function() {
            // æ£€æŸ¥æµè§ˆå™¨æ”¯æŒ
            if (!('showDirectoryPicker' in window)) {
                showError('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒæ–‡ä»¶ç³»ç»Ÿè®¿é—®APIï¼Œè¯·ä½¿ç”¨Chromeã€Edgeæˆ–Firefoxæœ€æ–°ç‰ˆæœ¬');
            }
        };
        
        // æ˜¾ç¤º/éšè—å¸®åŠ©å¯¹è¯æ¡†
        function toggleHelp() {
            const helpDialog = document.getElementById('helpDialog');
            if (helpDialog.classList.contains('show')) {
                helpDialog.classList.remove('show');
            } else {
                helpDialog.classList.add('show');
            }
        }
        
        // ç‚¹å‡»å¸®åŠ©å¯¹è¯æ¡†å¤–éƒ¨å…³é—­
        document.addEventListener('click', function(e) {
            const helpDialog = document.getElementById('helpDialog');
            const helpContent = document.querySelector('.help-content');
            if (e.target === helpDialog) {
                helpDialog.classList.remove('show');
            }
        });
    </script>
</body>
</html> 